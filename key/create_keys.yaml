- hosts: localhost
  vars:
    ansible_python_interpreter: /usr/bin/python3

  tasks:
    - set_fact:
        random_name: "sdia_{{ lookup('password', '/dev/null chars=ascii_lowercase,digits length=8') }}"
        
    - ec2_key:
        name: "{{random_name}}"
        region: "{{region}}"
      register: key_output
      
    - local_action: copy content={{ key_output }} dest=/tmp/key_output.json
                
    - include_tasks: create_key.yaml
      vars:
        instance_name: "{{ item.key }}"
      loop: "{{ instances | dict2items }}"
