- hosts: localhost
  vars:
      ansible_python_interpreter: /usr/bin/python3

  tasks:
    
    - ec2_vpc_subnet:
        state: present
        vpc_id: "{{vpc_id}}"
        cidr: 172.23.0.0/16
        region: "{{region}}"
        wait: yes
        tags:
          Name: "{{random_name}}"
      register: subnet_output

    - local_action: copy content={{ subnet_output }} dest=/tmp/{{random_name}}_ec2_subnet_output.json


    - include_tasks: vpc_subnet.yaml
      vars:
        instance_name: "{{ item.key }}"
      loop: "{{ instances | dict2items }}"
