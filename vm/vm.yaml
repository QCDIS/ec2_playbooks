# - ec2:
#     key_name: "{{ssh_key_name}}"
#     group: "{{security_group_name}}"
#     instance_type: "{{flavor}}"
#     image: "{{image_id}}"
#     region: "{{region}}"
#     wait: no
#     volumes:
#       - device_name: "{{volume_path}"
#         volume_type: "{{volume_type_name}}"
#         volume_size: "{{volume_size_num}}"
#         delete_on_termination: true
#     monitoring: yes
#     vpc_subnet_id: "{{subnet_id}}"
#     assign_public_ip: yes
#   register: ec2_output
#   when: volume_path is defined
#   until: ec2_output.rc == 0
#   retries: 10
#   delay: 1
#   ignore_errors: yes
  
  
- ec2:
    key_name: "{{ssh_key_name}}"
    group: "{{security_group_name}}"
    instance_type: "{{flavor}}"
    image: "{{image_id}}"
    region: "{{region}}"
    wait: no
    monitoring: yes
    vpc_subnet_id: "{{subnet_id}}"
    assign_public_ip: yes
    aws_access_key: "{{hostvars['localhost']['credentials'][0]['aws_access_key_id']}}"
    aws_secret_key: "{{hostvars['localhost']['credentials'][0]['aws_secret_access_key']}}"
  register: ec2_output
#   when: volume_path is not defined
#   until: ec2_output.rc == 0
#   retries: 10
#   delay: 1
#   ignore_errors: yes
  
- debug:
    var: ec2_output
    
    
